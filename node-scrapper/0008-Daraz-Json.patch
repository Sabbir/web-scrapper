From 917eed2d33d585832c2b3092de8bc5fa84411d87 Mon Sep 17 00:00:00 2001
From: unknown <sabbirhs@yahoo.com>
Date: Tue, 8 Nov 2022 11:27:02 +0600
Subject: [PATCH 8/8] Daraz Json

---
 node-scrapper/bugfix.patch             |  0
 node-scrapper/newchange.patch          |  0
 node-scrapper/src/services/scrapper.js | 25 +++++++++++++++----------
 3 files changed, 15 insertions(+), 10 deletions(-)
 delete mode 100644 node-scrapper/bugfix.patch
 delete mode 100644 node-scrapper/newchange.patch

diff --git a/node-scrapper/bugfix.patch b/node-scrapper/bugfix.patch
deleted file mode 100644
index e69de29..0000000
diff --git a/node-scrapper/newchange.patch b/node-scrapper/newchange.patch
deleted file mode 100644
index e69de29..0000000
diff --git a/node-scrapper/src/services/scrapper.js b/node-scrapper/src/services/scrapper.js
index 1b355f5..716d7d6 100644
--- a/node-scrapper/src/services/scrapper.js
+++ b/node-scrapper/src/services/scrapper.js
@@ -14,7 +14,7 @@ const scrapperScript = async (pr) => {
       // console.log($.html())
       
       var te = $("head > script")
-      console.log(te[3].lastChild.data)
+     
       // $("head > script").each((idx, elem) =>{
       //   console.log(idx+"::\n")
       //   console.log(elem['children'])
@@ -23,18 +23,23 @@ const scrapperScript = async (pr) => {
           
       //   }
       //})
-      const DataBooks = $('.head .script')
-     
+      const DataBooks = te[3].lastChild.data.replace("window.pageData=","")
+      
+      let l = JSON.parse(DataBooks)
+      let lItem = l.mods.listItems
       const scrapedData = []
-      DataBooks.each((index, el) => {
-        const scrapItem = { title: '', price: '' }
-        scrapItem.title = $(el).children('h3').text()
-        scrapItem.price = $(el)
-          .children('.product_price')
-          .children('p.price_color')
-          .text()
+      lItem.forEach(elem => {
+        const scrapItem = { title: '', price: '', url: '', img: ''}
+
+        scrapItem.title = elem.name
+        scrapItem.price = elem.price
+        scrapItem.url = elem.productUrl
+        scrapItem.img = elem.image
         scrapedData.push(scrapItem)
+
       })
+      
+      
       //console.dir(scrapedData)
       // fs.writeFile(
       //   './result/scrapedBooks.json',
-- 
2.37.3.windows.1

